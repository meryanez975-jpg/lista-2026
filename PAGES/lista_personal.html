<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- PWA -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#7c3aed">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <title>Lista del personal</title>
  <link rel="stylesheet" href="../estilo.css">
  <style>
    body { background: linear-gradient(160deg, #ffd6e7 0%, #fff0f6 40%, #fff8fb 100%); }
    .pers-header {
      background: linear-gradient(135deg, #ad1457, #c2185b, #e91e8c);
      border-radius: 0 0 36px 36px;
      padding: 28px 24px 22px;
      text-align: center;
      margin-bottom: 20px;
      box-shadow: 0 6px 20px rgba(173,20,87,.22);
      position: relative; overflow: hidden;
    }
    .pers-header::before {
      content:""; position:absolute; top:-30px; right:-30px;
      width:120px; height:120px; background:rgba(255,255,255,.10); border-radius:50%;
    }
    .pers-header h1 { margin:0 0 4px; color:#fff; font-size:24px; font-weight:900; }
    .pers-header p  { margin:0; color:rgba(255,255,255,.85); font-size:13px; }
    .panel { padding-top: 0 !important; }

    /* Tabs */
    .vista-tabs {
      display: flex; gap: 8px; margin-bottom: 16px;
    }
    .vista-tab {
      flex: 1; padding: 10px 6px; border: 2px solid #f48fb1;
      border-radius: 12px; background: #fff; color: #880e4f; font-size: 13px;
      font-weight: 700; cursor: pointer; text-align: center; transition: all .1s;
    }
    .vista-tab.activo { background: #ffd6e7; border-color: #e91e63; color: #5c0030; }
    .vista-tab:active { opacity: .8; }

    /* Grupos colapsables */
    .grupo-card {
      background: #fff; border: 2px solid #f0e8f8; border-radius: 16px;
      margin-bottom: 10px; overflow: hidden;
    }
    .grupo-btn {
      width: 100%; display: flex; justify-content: space-between; align-items: center;
      padding: 14px 16px; background: none; border: none; cursor: pointer;
      font-size: 15px; font-weight: 800; color: #4a2080; text-align: left;
    }
    .grupo-btn:active { background: #fdf0f8; }
    .grupo-btn .flecha { font-size: 18px; color: #c2185b; transition: transform .15s; }
    .grupo-btn.abierto .flecha { transform: rotate(180deg); }
    .grupo-nombres { border-top: 1px solid #f0e8f8; }

    /* Fila de persona (con editar) */
    .persona-fila {
      display: flex; justify-content: space-between; align-items: center;
      padding: 9px 14px; border-bottom: 1px solid #f8e0ec;
    }
    .persona-fila:last-child { border-bottom: none; }
    .persona-fila-info { font-size: 14px; font-weight: 600; color: #333; }
    .persona-fila-info .mini-info { font-size: 12px; color: #888; font-weight: 400; margin-top: 1px; }
    .btn-editar-mini {
      padding: 5px 10px; border: 1.5px solid #f48fb1; border-radius: 8px;
      background: #fff0f6; color: #c2185b; font-size: 13px; font-weight: 700;
      cursor: pointer; white-space: nowrap; flex-shrink: 0;
    }
    .btn-editar-mini:active { opacity: .7; }
    .btn-eliminar-mini {
      padding: 5px 10px; border: 1.5px solid #f44336; border-radius: 8px;
      background: #fff3f3; color: #c62828; font-size: 13px; font-weight: 700;
      cursor: pointer; white-space: nowrap; flex-shrink: 0;
    }
    .btn-eliminar-mini:active { opacity: .7; }
    .badge-libre {
      display: inline-block; background: #fff9c4; color: #7a5900;
      border-radius: 6px; padding: 1px 7px; font-size: 11px; font-weight: 800;
    }

    /* Colores por turno (horario) */
    .h-manana .grupo-btn { background: linear-gradient(135deg, #fce4ec, #fff); color: #880e4f; }
    .h-diurno .grupo-btn { background: linear-gradient(135deg, #e8f5e9, #fff); color: #1b5e20; }
    .h-tarde  .grupo-btn { background: linear-gradient(135deg, #fff8e1, #fff); color: #5f3700; }
    .h-noche  .grupo-btn { background: linear-gradient(135deg, #e3f2fd, #fff); color: #0d47a1; }
    .h-otro   .grupo-btn { background: linear-gradient(135deg, #f3e5f5, #fff); color: #4a148c; }
    .h-manana .grupo-btn .flecha { color: #c2185b; }
    .h-diurno .grupo-btn .flecha { color: #2e7d32; }
    .h-tarde  .grupo-btn .flecha { color: #f57f17; }
    .h-noche  .grupo-btn .flecha { color: #1565c0; }
    .h-otro   .grupo-btn .flecha { color: #7b1fa2; }
    .horario-sub { font-size: 11px; font-weight: 500; opacity: .7; display: block; margin-top: 2px; }

    /* Vista d√≠as libres */
    .turno-bloque { margin-bottom: 16px; }
    .turno-bloque-titulo {
      font-size: 14px; font-weight: 900; padding: 8px 14px; border-radius: 10px 10px 0 0;
      margin-bottom: 0; display: block; color: #fff;
    }
    .tb-manana { background: #c2185b; }
    .tb-noche  { background: #1565c0; }
    .tb-otro   { background: #555; }

    .tabla-libres { width: 100%; border-collapse: collapse; font-size: 13px; min-width: 340px; }
    .tabla-libres th {
      padding: 7px 5px; text-align: center; font-weight: 800;
      border-bottom: 2px solid rgba(0,0,0,.1); white-space: nowrap; background: rgba(0,0,0,.08);
    }
    .tabla-libres th:first-child { text-align: left; padding-left: 10px; }
    .tabla-libres td {
      padding: 6px 5px; text-align: center; border-bottom: 1px solid #f0e8f8; vertical-align: middle;
    }
    .tabla-libres td:first-child { text-align: left; font-weight: 700; padding-left: 10px; }
    .tabla-libres tr:last-child td { border-bottom: none; }
    .celda-libre {
      background: #fff9c4; color: #7a5900; font-weight: 900; font-size: 11px;
      border-radius: 6px; padding: 3px 5px; display: inline-block;
    }

    /* Modal de edici√≥n */
    .modal-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,.5);
      display: flex; align-items: center; justify-content: center;
      z-index: 1000; padding: 16px;
    }
    .modal-overlay.hidden { display: none !important; }
    .modal-box {
      background: #fff; border-radius: 20px; padding: 22px; max-width: 400px; width: 100%;
      box-shadow: 0 12px 40px rgba(0,0,0,.25); max-height: 90vh; overflow-y: auto;
    }
    .modal-titulo {
      font-size: 18px; font-weight: 900; color: #4a2080; margin-bottom: 16px;
    }
    .modal-campo { margin-bottom: 12px; }
    .modal-campo label { font-size: 12px; font-weight: 800; color: #555; display: block; margin-bottom: 4px; text-transform: uppercase; }
    .modal-campo input, .modal-campo select {
      width: 100%; padding: 10px 12px; border: 1.5px solid #f48fb1;
      border-radius: 10px; font-size: 14px; background: #fff;
    }
    .modal-campo input:focus, .modal-campo select:focus { border-color: #c2185b; outline: none; }
    .modal-btns { display: flex; gap: 10px; margin-top: 16px; }
    .btn-modal-guardar {
      flex: 1; padding: 12px; border: none; border-radius: 12px;
      background: linear-gradient(135deg,#c2185b,#e91e8c); color: #fff;
      font-weight: 800; cursor: pointer; font-size: 14px;
    }
    .btn-modal-cancelar {
      flex: 1; padding: 12px; border: 2px solid #f48fb1; border-radius: 12px;
      background: #fff; color: #880e4f; font-weight: 800; cursor: pointer; font-size: 14px;
    }
    .btn-modal-eliminar {
      padding: 12px 16px; border: 2px solid #f44336; border-radius: 12px;
      background: #fff; color: #f44336; font-weight: 800; cursor: pointer; font-size: 14px;
    }
    .msg-modal { font-size: 13px; margin-top: 8px; min-height: 18px; }

    @media print {
      .no-print { display: none !important; }
      body { background: #fff; }
      .panel { width: 100% !important; }
    }
  </style>
</head>
<body>

<main class="panel" style="padding-top:0;">
  <div class="pers-header no-print">
    <h1>üìã Lista del personal</h1>
    <p>Consulta y edita por sector, horario o d√≠as libres</p>
  </div>

  <!-- Tabs -->
  <div class="vista-tabs no-print">
    <button class="vista-tab activo" data-vista="sector"  type="button">üè¢ Sector</button>
    <button class="vista-tab"        data-vista="horario" type="button">üïê Horario</button>
    <button class="vista-tab"        data-vista="libres"  type="button">üìÖ D√≠as Libres</button>
  </div>

  <p class="loading" id="msgCarga">Cargando personal...</p>

  <!-- VISTA 1: POR SECTOR -->
  <div id="vistaSector" class="hidden"></div>

  <!-- VISTA 2: POR HORARIO -->
  <div id="vistaHorario" class="hidden"></div>

  <!-- VISTA 3: D√çAS LIBRES -->
  <div id="vistaLibres" class="hidden">
    <div style="display:flex; justify-content:flex-end; margin-bottom:10px;">
      <button class="btn-mini no-print" id="btnImprimir" type="button">üñ®Ô∏è Imprimir</button>
    </div>
    <div id="libresContenido"></div>
  </div>

  <!-- MODAL EDITAR PERSONA -->
  <div class="modal-overlay hidden" id="modalEditar">
    <div class="modal-box">
      <div class="modal-titulo">‚úèÔ∏è Editar persona</div>

      <div class="modal-campo">
        <label>Nombre completo</label>
        <input type="text" id="editNombre" placeholder="Ej: Mar√≠a Garc√≠a">
      </div>
      <div class="modal-campo">
        <label>Sector</label>
        <select id="editSector">
          <option value="bisuter√≠a">Bisuter√≠a</option>
          <option value="librer√≠a">Librer√≠a</option>
          <option value="cosm√©ticos">Cosm√©ticos</option>
          <option value="lili">Lili</option>
          <option value="otros">Otros (especificar)</option>
        </select>
      </div>
      <div class="modal-campo hidden" id="editCampoSectorTexto">
        <label>Especificar sector</label>
        <input type="text" id="editSectorTexto" placeholder="Escribir sector">
      </div>
      <div class="modal-campo">
        <label>D√≠a libre</label>
        <select id="editDiaLibre">
          <option value="lunes">Lunes</option>
          <option value="martes">Martes</option>
          <option value="mi√©rcoles">Mi√©rcoles</option>
          <option value="jueves">Jueves</option>
          <option value="viernes">Viernes</option>
          <option value="s√°bado">S√°bado</option>
          <option value="domingo">Domingo</option>
          <option value="otro">Otro (especificar)</option>
        </select>
      </div>
      <div class="modal-campo hidden" id="editCampoDiaLibreTexto">
        <label>Especificar d√≠a libre</label>
        <input type="text" id="editDiaLibreTexto" placeholder="Ej: Rotativo">
      </div>
      <div class="modal-campo">
        <label>Turno</label>
        <select id="editTurno">
          <option value="ma√±ana">Ma√±ana (7am‚Äì7pm)</option>
          <option value="diurno">Diurno (7am‚Äì4pm)</option>
          <option value="tarde">Tarde (11am‚Äì11pm)</option>
          <option value="noche">Noche (2pm‚Äì11pm)</option>
          <option value="otro">Otro (especificar)</option>
        </select>
      </div>
      <div class="modal-campo hidden" id="editCampoTurnoTexto">
        <label>Especificar turno</label>
        <input type="text" id="editTurnoTexto" placeholder="Ej: 6am‚Äì2pm">
      </div>

      <p class="msg-modal" id="msgModal"></p>

      <div class="modal-btns">
        <button class="btn-modal-guardar" id="btnModalGuardar" type="button">üíæ Guardar</button>
        <button class="btn-modal-cancelar" id="btnModalCancelar" type="button">Cancelar</button>
      </div>
      <div style="margin-top:10px;">
        <button class="btn-modal-eliminar" id="btnModalEliminar" type="button">üóëÔ∏è Eliminar persona</button>
      </div>
    </div>
  </div>

  <a class="btn-volver-bottom no-print" href="personal.html" style="margin-top:16px;">‚¨Ö Volver a Personal</a>
</main>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
<script src="../firebase-config.js"></script>
<script>
if (sessionStorage.getItem("admin_logged") !== "1") window.location.href = "admin.html";

let todosPersonal = {};
let vistaActual   = "sector";
let editandoKey   = null;

const vistaSector  = document.getElementById("vistaSector");
const vistaHorario = document.getElementById("vistaHorario");
const vistaLibres  = document.getElementById("vistaLibres");
const msgCarga     = document.getElementById("msgCarga");
const modalEditar  = document.getElementById("modalEditar");
const msgModal     = document.getElementById("msgModal");

// ===== CARGAR PERSONAL =====
dbGet("personal").then(data => {
  todosPersonal = data || {};
  msgCarga.classList.add("hidden");
  renderVista();
}).catch(() => {
  msgCarga.textContent = "‚ùå Error al cargar. Verifica el WiFi.";
});

// ===== TABS =====
document.querySelectorAll(".vista-tab").forEach(tab => {
  tab.addEventListener("click", () => {
    document.querySelectorAll(".vista-tab").forEach(t => t.classList.remove("activo"));
    tab.classList.add("activo");
    vistaActual = tab.dataset.vista;
    renderVista();
  });
});

function renderVista() {
  vistaSector.classList.add("hidden");
  vistaHorario.classList.add("hidden");
  vistaLibres.classList.add("hidden");

  if (vistaActual === "sector")  { vistaSector.classList.remove("hidden");  renderSector(); }
  if (vistaActual === "horario") { vistaHorario.classList.remove("hidden"); renderHorario(); }
  if (vistaActual === "libres")  { vistaLibres.classList.remove("hidden");  renderLibres(); }
}

function toggleGrupo(btn) {
  const nombres = btn.nextElementSibling;
  const abierto = !nombres.classList.contains("hidden");
  nombres.classList.toggle("hidden", abierto);
  btn.classList.toggle("abierto", !abierto);
}

// ===== VISTA 1: POR SECTOR (con editar) =====
function renderSector() {
  const personas = personasActivas();
  if (!personas.length) {
    vistaSector.innerHTML = '<p class="nota" style="text-align:center;">Sin personal activo.</p>';
    return;
  }

  const porSector = {};
  SECTORES.forEach(s => porSector[s] = []);
  personas.forEach(([key, p]) => {
    const s = p.sector || "otros";
    if (!porSector[s]) porSector[s] = [];
    porSector[s].push({ key, ...p });
  });

  let html = "";
  SECTORES.forEach(s => {
    const lista = porSector[s] || [];
    if (!lista.length) return;
    const sLabel = s.charAt(0).toUpperCase() + s.slice(1);

    const filas = lista.map(p => `
      <div class="persona-fila">
        <div class="persona-fila-info">
          <div>${p.nombre}</div>
          <div class="mini-info"><span class="badge-libre">üìÖ ${labelDiaLibre(p)}</span> ¬∑ ${labelTurno(p)}</div>
        </div>
        <div style="display:flex;gap:6px;flex-shrink:0;">
          <button class="btn-editar-mini" data-key="${p.key}" type="button">‚úèÔ∏è</button>
          <button class="btn-eliminar-mini" data-key="${p.key}" type="button">üóëÔ∏è</button>
        </div>
      </div>`).join("");

    html += `
      <div class="grupo-card">
        <button class="grupo-btn" type="button" onclick="toggleGrupo(this)">
          <span>${sLabel} <span style="font-size:12px; font-weight:500; color:#888;">(${lista.length})</span></span>
          <span class="flecha">‚ñæ</span>
        </button>
        <div class="grupo-nombres hidden">${filas}</div>
      </div>`;
  });

  vistaSector.innerHTML = html || '<p class="nota">Sin personal.</p>';

  // Eventos de editar y eliminar
  vistaSector.querySelectorAll(".btn-editar-mini").forEach(btn => {
    btn.addEventListener("click", () => abrirModalEditar(btn.dataset.key));
  });
  vistaSector.querySelectorAll(".btn-eliminar-mini").forEach(btn => {
    btn.addEventListener("click", () => eliminarPersonaDirecto(btn.dataset.key));
  });
}

// ===== VISTA 2: POR HORARIO (colapsable) =====
function renderHorario() {
  const personas = personasActivas();
  const turnos = ["ma√±ana","diurno","tarde","noche","otro"];
  const porTurno = {};
  turnos.forEach(t => porTurno[t] = []);

  personas.forEach(([, p]) => {
    const t = turnos.includes(p.turno) ? p.turno : "otro";
    porTurno[t].push(p);
  });

  const claseH = { ma√±ana:"h-manana", diurno:"h-diurno", tarde:"h-tarde", noche:"h-noche", otro:"h-otro" };

  let html = "";
  turnos.forEach(t => {
    const lista = porTurno[t] || [];
    if (!lista.length) return;
    const info  = TURNOS[t];
    const label = info?.label || "Otro turno";
    const comidas = (info?.comidas || COMIDAS_ALL).map(c => `${COMIDA_ICON[c]} ${COMIDA_LABEL[c]}`).join("  ");

    html += `
      <div class="grupo-card ${claseH[t]}">
        <button class="grupo-btn" type="button" onclick="toggleGrupo(this)">
          <span>
            ${label} <span style="font-size:12px; font-weight:500; opacity:.7;">(${lista.length})</span>
            <span class="horario-sub">${comidas}</span>
          </span>
          <span class="flecha">‚ñæ</span>
        </button>
        <div class="grupo-nombres hidden">
          ${lista.map(p => `
            <div class="persona-fila">
              <div class="persona-fila-info">
                <div>${p.nombre}</div>
                <div class="mini-info">${labelSector(p)} ¬∑ <span class="badge-libre">üìÖ ${labelDiaLibre(p)} libre</span></div>
              </div>
            </div>`).join("")}
        </div>
      </div>`;
  });

  vistaHorario.innerHTML = html || '<p class="nota">Sin personal.</p>';
}

// ===== VISTA 3: D√çAS LIBRES ‚Äî Separado por turno =====
function renderLibres() {
  const personas = personasActivas();
  const contenedor = document.getElementById("libresContenido");

  if (!personas.length) {
    contenedor.innerHTML = '<p class="nota" style="text-align:center;">Sin personal activo.</p>';
    return;
  }

  const grupos = [
    { label: "‚òÄÔ∏è Turno Ma√±ana",     cls: "tb-manana", turnos: ["ma√±ana","diurno"] },
    { label: "üåô Turno Tarde / Noche", cls: "tb-noche",  turnos: ["tarde","noche"] },
    { label: "‚öôÔ∏è Otros turnos",       cls: "tb-otro",  turnos: ["otro"] }
  ];

  function tablaGrupo(lista) {
    // Ordenar por d√≠a libre
    const sorted = [...lista].sort((a, b) => {
      const ia = idxDiaLibre(a[1]);
      const ib = idxDiaLibre(b[1]);
      if (ia !== ib) return ia - ib;
      return (a[1].nombre || "").localeCompare(b[1].nombre || "", "es");
    });
    return sorted.map(([, p]) => {
      const diaIdx = idxDiaLibre(p);
      const celdas = [0,1,2,3,4,5,6].map(i =>
        i === diaIdx
          ? `<td><span class="celda-libre">LIBRE</span></td>`
          : `<td></td>`
      ).join("");
      return `<tr><td>${p.nombre}</td>${celdas}</tr>`;
    }).join("");
  }

  let html = "";
  grupos.forEach(grupo => {
    const lista = personas.filter(([, p]) => grupo.turnos.includes(p.turno || "otro"));
    if (!lista.length) return;

    html += `
      <div class="turno-bloque form-card" style="padding:0; overflow:hidden; margin-bottom:14px;">
        <span class="turno-bloque-titulo ${grupo.cls}">${grupo.label} (${lista.length})</span>
        <div style="overflow-x:auto;">
          <table class="tabla-libres">
            <thead><tr>
              <th>Nombre</th>
              <th>Lun</th><th>Mar</th><th>Mi√©</th>
              <th>Jue</th><th>Vie</th><th>S√°b</th><th>Dom</th>
            </tr></thead>
            <tbody>${tablaGrupo(lista)}</tbody>
          </table>
        </div>
      </div>`;
  });

  contenedor.innerHTML = html;
}

// ===== MODAL EDITAR =====
function abrirModalEditar(key) {
  const p = todosPersonal[key];
  if (!p) return;
  editandoKey = key;

  document.getElementById("editNombre").value      = p.nombre || "";
  document.getElementById("editSector").value      = p.sector || "otros";
  document.getElementById("editSectorTexto").value = p.sectorTexto || "";
  document.getElementById("editDiaLibre").value    = p.diaLibre || "lunes";
  document.getElementById("editDiaLibreTexto").value = p.diaLibreTexto || "";
  document.getElementById("editTurno").value       = p.turno || "ma√±ana";
  document.getElementById("editTurnoTexto").value  = p.turnoTexto || "";

  document.getElementById("editCampoSectorTexto").classList.toggle("hidden", p.sector !== "otros");
  document.getElementById("editCampoDiaLibreTexto").classList.toggle("hidden", p.diaLibre !== "otro");
  document.getElementById("editCampoTurnoTexto").classList.toggle("hidden", p.turno !== "otro");

  msgModal.textContent = "";
  modalEditar.classList.remove("hidden");
}

function cerrarModal() {
  modalEditar.classList.add("hidden");
  editandoKey = null;
  msgModal.textContent = "";
}

// Cambios condicionales en modal
document.getElementById("editSector").addEventListener("change", e => {
  document.getElementById("editCampoSectorTexto").classList.toggle("hidden", e.target.value !== "otros");
});
document.getElementById("editDiaLibre").addEventListener("change", e => {
  document.getElementById("editCampoDiaLibreTexto").classList.toggle("hidden", e.target.value !== "otro");
});
document.getElementById("editTurno").addEventListener("change", e => {
  document.getElementById("editCampoTurnoTexto").classList.toggle("hidden", e.target.value !== "otro");
});

document.getElementById("btnModalCancelar").addEventListener("click", cerrarModal);
modalEditar.addEventListener("click", e => { if (e.target === modalEditar) cerrarModal(); });

// Guardar edici√≥n
document.getElementById("btnModalGuardar").addEventListener("click", async () => {
  if (!editandoKey) return;
  const nombre   = document.getElementById("editNombre").value.trim();
  const sector   = document.getElementById("editSector").value;
  const diaLibre = document.getElementById("editDiaLibre").value;
  const turno    = document.getElementById("editTurno").value;

  if (!nombre) { msgModal.textContent = "El nombre es requerido."; return; }

  const datos = {
    nombre, sector, diaLibre, turno,
    activo: todosPersonal[editandoKey]?.activo ?? true
  };
  if (sector === "otros")   datos.sectorTexto    = document.getElementById("editSectorTexto").value.trim();
  if (diaLibre === "otro")  datos.diaLibreTexto  = document.getElementById("editDiaLibreTexto").value.trim();
  if (turno === "otro")     datos.turnoTexto     = document.getElementById("editTurnoTexto").value.trim();

  const btn = document.getElementById("btnModalGuardar");
  btn.disabled = true;
  btn.textContent = "Guardando...";
  msgModal.textContent = "";

  try {
    await dbSet(`personal/${editandoKey}`, datos);
    todosPersonal[editandoKey] = datos;
    msgModal.textContent = "‚úÖ Guardado.";
    setTimeout(() => {
      cerrarModal();
      renderVista();
    }, 700);
  } catch {
    msgModal.textContent = "‚ùå Error al guardar. Verifica el WiFi.";
  }

  btn.disabled = false;
  btn.textContent = "üíæ Guardar";
});

// Eliminar
document.getElementById("btnModalEliminar").addEventListener("click", async () => {
  if (!editandoKey) return;
  const nombre = todosPersonal[editandoKey]?.nombre || "esta persona";
  if (!confirm(`¬øEliminar a "${nombre}"? Esta acci√≥n no se puede deshacer.`)) return;

  try {
    await dbRemove(`personal/${editandoKey}`);
    await dbRemove(`registros/${editandoKey}`);
    delete todosPersonal[editandoKey];
    cerrarModal();
    renderVista();
  } catch {
    msgModal.textContent = "‚ùå Error al eliminar.";
  }
});

// Imprimir
document.getElementById("btnImprimir").addEventListener("click", () => window.print());

// ===== ELIMINAR DIRECTO (desde vista sector) =====
async function eliminarPersonaDirecto(key) {
  const nombre = todosPersonal[key]?.nombre || "esta persona";
  if (!confirm(`¬øEliminar a "${nombre}"?\nEsta acci√≥n no se puede deshacer.`)) return;
  try {
    await dbRemove(`personal/${key}`);
    await dbRemove(`registros/${key}`);
    delete todosPersonal[key];
    renderVista();
  } catch {
    alert("‚ùå Error al eliminar. Verifica el WiFi.");
  }
}

// Helper
function personasActivas() {
  return Object.entries(todosPersonal)
    .filter(([, p]) => p.activo)
    .sort((a, b) => (a[1].nombre || "").localeCompare(b[1].nombre || "", "es"));
}
</script>

</body>
</html>
